//var ID=null;
function getXHR(){
    var xhrObject = null;
    if(window.XMLHttpRequest){
        xhrObject = new XMLHttpRequest();
    }else{
        alert("Votre navigateur actuelle ne supporte pas les XMLHttpRequest.\n"+
        "Veuillez essayer avec un autre navigateur");
        xhrObject = false;
    }
    return xhrObject;
}
function chargementFichierJson(){
    const xhrObject = getXHR();
    xhrObject.onload=function(){
        fichierJson(this.responseText);
    };
    xhrObject.open("GET","./data/products.json");
    xhrObject.send();
}

function fichierJson(json){
    var ObjJSON=JSON.parse(json);
    ObjJSON.sort(function(a,b){
        return a.name.localeCompare(b.name);
    });
    let listDeProduits=document.getElementById("products-list");
    for (var i = 0; i < ObjJSON.length; i++){
        if (i==0){
            listDeProduits.innerHTML="<div id=\""+ ObjJSON[i].id +"\" class=\"product\">\n<a href=\"./product.html\?id="+ encodeURI(ObjJSON[i].id)+"\" title=\"En savoir plus...\">\n"
            +"<h2>"+ObjJSON[i].name+"</h2>\n"
            +"<img src=\"./assets/img/"+ ObjJSON[i].image +"\">\n"
            +"<p class=\"price\"><small>Prix</small>"+ ObjJSON[i].price +"&thinsp;$</p>\n"
            +"</a>\n"
            +"</div>\n";
        }else{
            listDeProduits.innerHTML+="<div id=\""+ ObjJSON[i].id +"\" class=\"product\">\n<a href=\"./product.html\?id="+ encodeURI(ObjJSON[i].id)+"\"title=\"En savoir plus...\">\n"
            +"<h2>"+ObjJSON[i].name+"</h2>\n"
            +"<img src=\"./assets/img/"+ ObjJSON[i].image +"\">\n"
            +"<p class=\"price\"><small>Prix</small>"+ ObjJSON[i].price +"&thinsp;$</p>\n"
            +"</a>\n"
            +"</div>\n";
        }
    }
}
function chargementProduit(){
    const xhrObject = getXHR();
    var address=document.URL.indexOf('?');
    console.log(address);
    var params = new Array();
    xhrObject.onload=function(){
        params=parameters(address,params)
        chargementPageProduit(this.responseText,params.id)
    };
    xhrObject.open("GET","./data/products.json");
    xhrObject.send();
}

function parameters(address, params){
    console.log("test");
    var pairs = document.URL.substring(address+1, document.URL.length).split('&');
    for (var i=0; i<pairs.length; i++) {
        nameVal = pairs[i].split('=');
        params[nameVal[0]] = nameVal[1];
        console.log(params[nameVal[0]]);
    }
    return params
}
function chargementPageProduit(json, id){
    var ObjJSON=JSON.parse(json);
    let productPage=document.getElementsByTagName("article");
    console.log(productPage.innerHTML)
    for(var i=0; i<ObjJSON.length; i++){
        if(ObjJSON[i].id==id){
            productPage[0].innerHTML="<h1>"+ObjJSON[i].name+"</h1>"+
            "<div class=\"row\">\n"+
            "\t<div class=\"col\">\n"+
            "\t\t<img id=\"product-image\" alt=\""+ ObjJSON[i].name +"\" src=\"./assets/img/"+ ObjJSON[i].image +"\">\n"+
            "\t</div>\n"+
            "\t<div class=\"col\">\n"+
            "\t\t<section>\n"+
            "\t\t\t<h2>Description</h2>\n"+
            "\t\t\t<p>"+ ObjJSON[i].description +"</p>\n"+
            "\t\t</section>\n"+
            "\t\t<section>\n"+
            "\t\t\t<h2>Caractéristiques</h2>\n"+
            "\t\t\t<ul>\n"+//;
            "\t\t\t\t<li>"+ObjJSON[i].features[0]+"</li>\n"+
            "\t\t\t\t<li>"+ObjJSON[i].features[1]+"</li>\n"+
            "\t\t\t\t<li>"+ObjJSON[i].features[2]+"</li>\n"+
            "\t\t\t\t<li>"+ObjJSON[i].features[3]+"</li>\n"+
            "\t\t\t\t<li>"+ObjJSON[i].features[4]+"</li>\n"+
            "\t\t\t</ul>\n"+
            "\t\t</section>\n"+
            "\t\t<hr>\n"+
            "\t\t<form class=\"pull-right\">\n"+
            "\t\t\t<label for=\"product-quantity\">Quantité:</label>"+
            "\t\t\t<input class=\"form-control\" id=\"product-quantity\" type=\"number\" value=\"1\" min=\"1\">"+
            "\t\t\t<button class=\"btn\" title=\"Ajouter au panier\" type=\"submit\">"+
            "\t\t\t\t<i class=\"fa fa-cart-plus\"></i>&nbsp; Ajouter"+
            "\t\t\t</button>"+
            "\t\t</form>"+
            "\t\t<p>Prix: <strong>"+ ObjJSON[i].price +"&thinsp;$</strong></p>"+
            "\t</div>"+
            "</div>"
        }
    }


}
// const 
// $(function(){
//     if ( document.URL.includes("products.html") ) {
//         var jsonFile="./data/products.json";
//         $.getJSON(jsonFile, function(json){
//             chargement(json);
//         });
//     }
    
// });
// function fichierJson(){
    
// }
// function chargement(json){
    
// }